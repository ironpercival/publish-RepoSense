[{"path":"kmaooad-functions/src/main/java/edu/kmaooad/Dispatcher.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.handlers.Handler;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.services.SessionService;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.models.Session;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.StateMachine;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Component;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.CallbackQuery;"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.Message;"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"import java.util.ArrayList;"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"import java.util.List;"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"import java.util.Optional;"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"@Component"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"public class Dispatcher {"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"    private final List\u003cHandler\u003e handlers \u003d new ArrayList\u003c\u003e();"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"    private final SessionService sessionService;"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"    private final StateMachine stateMachine;"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"    public Dispatcher(StateMachine stateMachine, SessionService sessionService) {"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":"        this.stateMachine \u003d stateMachine;"},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"        this.sessionService \u003d sessionService;"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"    public void registerHandler(Handler handler) {"},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":"        handlers.add(handler);"},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":32,"author":{"gitId":"sun-ok"},"content":"    public boolean dispatch(Message message) {"},{"lineNumber":33,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":34,"author":{"gitId":"sun-ok"},"content":"        Optional\u003cHandler\u003e commandHandler \u003d handlers.stream().filter(h -\u003e h.hasCommand(message.getText())).findFirst();"},{"lineNumber":35,"author":{"gitId":"sun-ok"},"content":"        if (commandHandler.isPresent()) {"},{"lineNumber":36,"author":{"gitId":"sun-ok"},"content":"            commandHandler.get().handle(message, stateMachine);"},{"lineNumber":37,"author":{"gitId":"sun-ok"},"content":"            return true;"},{"lineNumber":38,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":39,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":40,"author":{"gitId":"sun-ok"},"content":"        Optional\u003cHandler\u003e stateHandler \u003d getHandlerByState(message.getChatId());"},{"lineNumber":41,"author":{"gitId":"sun-ok"},"content":"        if (stateHandler.isPresent()) {"},{"lineNumber":42,"author":{"gitId":"sun-ok"},"content":"            stateHandler.get().handle(message, stateMachine);"},{"lineNumber":43,"author":{"gitId":"sun-ok"},"content":"            return true;"},{"lineNumber":44,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":45,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":46,"author":{"gitId":"sun-ok"},"content":"        return false;"},{"lineNumber":47,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":48,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":49,"author":{"gitId":"sun-ok"},"content":"    public boolean dispatch(CallbackQuery callbackQuery) {"},{"lineNumber":50,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":51,"author":{"gitId":"sun-ok"},"content":"        Optional\u003cHandler\u003e stateHandler \u003d getHandlerByState(callbackQuery.getMessage().getChatId());"},{"lineNumber":52,"author":{"gitId":"sun-ok"},"content":"        if (stateHandler.isPresent()) {"},{"lineNumber":53,"author":{"gitId":"sun-ok"},"content":"            stateHandler.get().handle(callbackQuery, stateMachine);"},{"lineNumber":54,"author":{"gitId":"sun-ok"},"content":"            return true;"},{"lineNumber":55,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":56,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":57,"author":{"gitId":"sun-ok"},"content":"        return false;"},{"lineNumber":58,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":59,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":60,"author":{"gitId":"sun-ok"},"content":"    private Optional\u003cHandler\u003e getHandlerByState(Long chatId) {"},{"lineNumber":61,"author":{"gitId":"sun-ok"},"content":"        Session session \u003d sessionService.getSessionByUserId(chatId).orElseGet(() -\u003e {"},{"lineNumber":62,"author":{"gitId":"sun-ok"},"content":"                    try {"},{"lineNumber":63,"author":{"gitId":"sun-ok"},"content":"                        return sessionService.createSessionById(chatId);"},{"lineNumber":64,"author":{"gitId":"sun-ok"},"content":"                    } catch (Exception e) {"},{"lineNumber":65,"author":{"gitId":"sun-ok"},"content":"                        throw new RuntimeException(e);"},{"lineNumber":66,"author":{"gitId":"sun-ok"},"content":"                    }"},{"lineNumber":67,"author":{"gitId":"sun-ok"},"content":"                });"},{"lineNumber":68,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":69,"author":{"gitId":"sun-ok"},"content":"        return handlers.stream().filter(h -\u003e h.getState() !\u003d null).filter(h -\u003e h.getState().key().equalsIgnoreCase(session.currentState)).findFirst();"},{"lineNumber":70,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":71,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":71}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/config/MongoMapKeyDotReplacementConfiguration.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.config;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import org.springframework.beans.factory.annotation.Autowired;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import org.springframework.context.annotation.Configuration;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import org.springframework.data.mongodb.core.convert.MappingMongoConverter;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"@Configuration"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"public class MongoMapKeyDotReplacementConfiguration {"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"    @Autowired"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"    public void setMapKeyDotReplacement(MappingMongoConverter mongoConverter) {"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"        mongoConverter.setMapKeyDotReplacement(\"#\");"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":14}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/config/SpringConfig.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"package edu.kmaooad.config;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"-"},"content":"import org.springframework.beans.factory.annotation.Autowired;"},{"lineNumber":4,"author":{"gitId":"-"},"content":"import org.springframework.context.annotation.Bean;"},{"lineNumber":5,"author":{"gitId":"-"},"content":"import org.springframework.context.annotation.Configuration;"},{"lineNumber":6,"author":{"gitId":"-"},"content":"import org.telegram.telegrambots.meta.api.methods.updates.SetWebhook;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"import org.springframework.context.MessageSource;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"import org.springframework.context.support.ReloadableResourceBundleMessageSource;"},{"lineNumber":9,"author":{"gitId":"-"},"content":""},{"lineNumber":10,"author":{"gitId":"-"},"content":"@Configuration"},{"lineNumber":11,"author":{"gitId":"-"},"content":"public class SpringConfig {"},{"lineNumber":12,"author":{"gitId":"-"},"content":"    private final TelegramConfig telegramConfig;"},{"lineNumber":13,"author":{"gitId":"-"},"content":""},{"lineNumber":14,"author":{"gitId":"-"},"content":"    @Autowired"},{"lineNumber":15,"author":{"gitId":"-"},"content":"    public SpringConfig(TelegramConfig telegramConfig) {"},{"lineNumber":16,"author":{"gitId":"-"},"content":"        this.telegramConfig \u003d telegramConfig;"},{"lineNumber":17,"author":{"gitId":"-"},"content":"    }"},{"lineNumber":18,"author":{"gitId":"-"},"content":""},{"lineNumber":19,"author":{"gitId":"-"},"content":"    @Bean"},{"lineNumber":20,"author":{"gitId":"-"},"content":"    public SetWebhook setWebhookInstance() {"},{"lineNumber":21,"author":{"gitId":"-"},"content":"        return SetWebhook.builder().url(telegramConfig.getWebhookPath()).build();"},{"lineNumber":22,"author":{"gitId":"-"},"content":"    }"},{"lineNumber":23,"author":{"gitId":"-"},"content":""},{"lineNumber":24,"author":{"gitId":"-"},"content":"    @Bean"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"    public MessageSource messageSource() {"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"        ReloadableResourceBundleMessageSource messageSource"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":"                \u003d new ReloadableResourceBundleMessageSource();"},{"lineNumber":28,"author":{"gitId":"-"},"content":""},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":"        messageSource.setBasename(\"classpath:messages\");"},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":"        messageSource.setDefaultEncoding(\"UTF-8\");"},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":"        return messageSource;"},{"lineNumber":32,"author":{"gitId":"-"},"content":"    }"},{"lineNumber":33,"author":{"gitId":"-"},"content":"}"}],"authorContributionMap":{"-":24,"sun-ok":9}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/config/TelegramConfig.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.config;"},{"lineNumber":2,"author":{"gitId":"-"},"content":""},{"lineNumber":3,"author":{"gitId":"-"},"content":"import lombok.Getter;"},{"lineNumber":4,"author":{"gitId":"-"},"content":"import org.springframework.beans.factory.annotation.Value;"},{"lineNumber":5,"author":{"gitId":"-"},"content":"import org.springframework.stereotype.Component;"},{"lineNumber":6,"author":{"gitId":"-"},"content":""},{"lineNumber":7,"author":{"gitId":"-"},"content":"/**"},{"lineNumber":8,"author":{"gitId":"-"},"content":" * Bot settings"},{"lineNumber":9,"author":{"gitId":"-"},"content":" */"},{"lineNumber":10,"author":{"gitId":"-"},"content":""},{"lineNumber":11,"author":{"gitId":"-"},"content":"@Component"},{"lineNumber":12,"author":{"gitId":"-"},"content":"@Getter"},{"lineNumber":13,"author":{"gitId":"-"},"content":"public class TelegramConfig {"},{"lineNumber":14,"author":{"gitId":"-"},"content":""},{"lineNumber":15,"author":{"gitId":"-"},"content":"    @Value(\"${webhook-path}\")"},{"lineNumber":16,"author":{"gitId":"-"},"content":"    String webhookPath;"},{"lineNumber":17,"author":{"gitId":"-"},"content":""},{"lineNumber":18,"author":{"gitId":"-"},"content":"    @Value(\"${bot-name}\")"},{"lineNumber":19,"author":{"gitId":"-"},"content":"    String botName;"},{"lineNumber":20,"author":{"gitId":"-"},"content":""},{"lineNumber":21,"author":{"gitId":"-"},"content":"    @Value(\"${bot-token}\")"},{"lineNumber":22,"author":{"gitId":"-"},"content":"    String botToken;"},{"lineNumber":23,"author":{"gitId":"-"},"content":"}"}],"authorContributionMap":{"sun-ok":1,"-":22}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/handlers/Handler.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.handlers;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.State;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.StateMachine;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.CallbackQuery;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.Message;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"import java.util.ArrayList;"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"import java.util.List;"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"public abstract class Handler {"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"    protected Handler(List\u003cString\u003e commands, State state){"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":"        this.commands \u003d commands;"},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"        this.state \u003d state;"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"    public abstract void handle(Message message, StateMachine stateMachine);"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"    public void handle(CallbackQuery callbackQuery, StateMachine stateMachine) {}"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"    final public List\u003cString\u003e getCommands() {"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":"        return commands;"},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"    final public State getState() {"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":"        return state;"},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":"    final public boolean hasCommand(String command) {"},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":"        return getCommands() !\u003d null \u0026\u0026 getCommands().stream().anyMatch(c -\u003e (\"/\" + c).equalsIgnoreCase(command));"},{"lineNumber":32,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":33,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":34,"author":{"gitId":"sun-ok"},"content":"    private List\u003cString\u003e commands;"},{"lineNumber":35,"author":{"gitId":"sun-ok"},"content":"    private State state;"},{"lineNumber":36,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":36}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/handlers/experts/CreateExpert.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.handlers.experts;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.State;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"public enum CreateExpert implements State, State.Group {"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"    NAME, EMAIL, TYPE, SAVING;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"    public String key() {"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"        return getClass().getName() + \".\" + name();"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":12}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/handlers/experts/CreateExpertEmailHandler.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.handlers.experts;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.services.TelegramService;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.handlers.Handler;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.models.Expert;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.StateMachine;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"import org.springframework.beans.factory.annotation.Autowired;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Component;"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.Message;"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"@Component"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"public class CreateExpertEmailHandler extends Handler {"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"    private final TelegramService telegramService;"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"    @Autowired"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"    public CreateExpertEmailHandler(TelegramService telegramService) {"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":"        super(null, CreateExpert.EMAIL);"},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"        this.telegramService \u003d telegramService;"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"    public void handle(Message message, StateMachine stateMachine) {"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":"        try {"},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"            Expert expert \u003d stateMachine"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"                    .getStateCache(message.getChatId(), CreateExpert.TYPE, Expert.class)"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"                    .orElseThrow();"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"            expert.setType(message.getText());"},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":"            stateMachine.updateStateCache(message.getChatId(), CreateExpert.EMAIL, expert);"},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":"            stateMachine.setState(message.getChatId(), CreateExpert.SAVING);"},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":"            telegramService.sendMessage(message.getChatId(), \"reply.getEmail\");"},{"lineNumber":32,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":33,"author":{"gitId":"sun-ok"},"content":"        } catch (Exception exception) {"},{"lineNumber":34,"author":{"gitId":"sun-ok"},"content":"            telegramService.sendMessage(message.getChatId(), \"reply.error\");"},{"lineNumber":35,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":36,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":37,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":37}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/handlers/experts/CreateExpertNameHandler.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.handlers.experts;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.services.TelegramService;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.handlers.Handler;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.State;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.StateMachine;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Component;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.Message;"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"import java.util.List;"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"@Component"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"public class CreateExpertNameHandler extends Handler {"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"    private final TelegramService telegramService;"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":"    public CreateExpertNameHandler(TelegramService telegramService) {"},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"        super(List.of(\"createExpert\"), new State.Any());"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"        this.telegramService \u003d telegramService;"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":"    public void handle(Message message, StateMachine stateMachine) {"},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"        try {"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"            stateMachine.setState(message.getChatId(), CreateExpert.TYPE);"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"            telegramService.sendMessage(message.getChatId(), \"reply.getName\");"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":"        } catch (Exception e) {"},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"            telegramService.sendMessage(message.getChatId(), \"reply.error\");"},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":31}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/handlers/experts/CreateExpertSavingHandler.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.handlers.experts;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.services.ExpertsService;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.services.TelegramService;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.handlers.Handler;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.models.Expert;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.State;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.StateMachine;"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Component;"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.Message;"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"@Component"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"public class CreateExpertSavingHandler extends Handler {"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"    private final TelegramService telegramService;"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"    private final ExpertsService expertService;"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"    public CreateExpertSavingHandler(TelegramService telegramService, ExpertsService expertService) {"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"        super(null, CreateExpert.SAVING);"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"        this.telegramService \u003d telegramService;"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":"        this.expertService \u003d expertService;"},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"    public void handle(Message message, StateMachine stateMachine) {"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"        try {"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":"            Expert expert \u003d stateMachine"},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"                    .getStateCache(message.getChatId(), CreateExpert.EMAIL, Expert.class)"},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":"                    .orElseThrow();"},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":"            expert.setEmail(message.getText());"},{"lineNumber":32,"author":{"gitId":"sun-ok"},"content":"            expertService.createExpert(expert);"},{"lineNumber":33,"author":{"gitId":"sun-ok"},"content":"            stateMachine.setState(message.getChatId(), new State.Any());"},{"lineNumber":34,"author":{"gitId":"sun-ok"},"content":"            telegramService.sendMessage(message.getChatId(), \"reply.expertWasCreated\");"},{"lineNumber":35,"author":{"gitId":"sun-ok"},"content":"        } catch (Exception exception) {"},{"lineNumber":36,"author":{"gitId":"sun-ok"},"content":"            telegramService.sendMessage(message.getChatId(), \"reply.error\");"},{"lineNumber":37,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":38,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":39,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":39}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/handlers/experts/CreateExpertTypeHandler.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.handlers.experts;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.services.TelegramService;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.handlers.Handler;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.models.Expert;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.StateMachine;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Component;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.Message;"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"@Component"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"public class CreateExpertTypeHandler extends Handler {"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"    private final TelegramService telegramService;"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"    public CreateExpertTypeHandler(TelegramService telegramService) {"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"        super(null, CreateExpert.TYPE);"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":"        this.telegramService \u003d telegramService;"},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":"    public void handle(Message message, StateMachine stateMachine) {"},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"        try {"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":"            //asked for name in previous step"},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"            String expertName \u003d message.getText();"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"            Expert expert \u003d new Expert(null, null, expertName);"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"            stateMachine.updateStateCache(message.getChatId(), CreateExpert.NAME, expert);"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":"            stateMachine.setState(message.getChatId(), CreateExpert.EMAIL);"},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"            telegramService.sendMessage(message.getChatId(), \"reply.getType\");"},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":"        } catch (Exception exception) {"},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":"            telegramService.sendMessage(message.getChatId(), \"reply.error\");"},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":32,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":33,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":33}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/models/Expert.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"package edu.kmaooad.models;"},{"lineNumber":2,"author":{"gitId":"-"},"content":""},{"lineNumber":3,"author":{"gitId":"-"},"content":"import com.fasterxml.jackson.annotation.JsonProperty;"},{"lineNumber":4,"author":{"gitId":"-"},"content":"import lombok.*;"},{"lineNumber":5,"author":{"gitId":"-"},"content":""},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"/*"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"* Entity that represents expert"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"*/"},{"lineNumber":9,"author":{"gitId":"-"},"content":"@AllArgsConstructor"},{"lineNumber":10,"author":{"gitId":"-"},"content":"@NoArgsConstructor"},{"lineNumber":11,"author":{"gitId":"-"},"content":"@Getter"},{"lineNumber":12,"author":{"gitId":"-"},"content":"@Setter"},{"lineNumber":13,"author":{"gitId":"-"},"content":"@ToString"},{"lineNumber":14,"author":{"gitId":"-"},"content":"public class Expert {"},{"lineNumber":15,"author":{"gitId":"-"},"content":""},{"lineNumber":16,"author":{"gitId":"-"},"content":"    @JsonProperty()"},{"lineNumber":17,"author":{"gitId":"-"},"content":"    private String email;"},{"lineNumber":18,"author":{"gitId":"-"},"content":""},{"lineNumber":19,"author":{"gitId":"-"},"content":"    @JsonProperty()"},{"lineNumber":20,"author":{"gitId":"-"},"content":"    private String type;"},{"lineNumber":21,"author":{"gitId":"-"},"content":""},{"lineNumber":22,"author":{"gitId":"-"},"content":"    @JsonProperty()"},{"lineNumber":23,"author":{"gitId":"-"},"content":"    private String name;"},{"lineNumber":24,"author":{"gitId":"-"},"content":""},{"lineNumber":25,"author":{"gitId":"-"},"content":"}"}],"authorContributionMap":{"-":22,"sun-ok":3}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/models/Session.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.models;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.State;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import lombok.*;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import java.util.HashMap;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"import java.util.Map;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"/*"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"* Stores the state of bot session with the user"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"*/"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"@AllArgsConstructor"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"@NoArgsConstructor"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":"@Getter"},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"@Setter"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"@ToString"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":"public class Session"},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"{"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"    public Session(Long id) {"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"        this.id \u003d id;"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":"        this.currentState \u003d new State.Any().key();"},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"        this.statesCache \u003d new HashMap\u003c\u003e();"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"    public Long id;"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"    public String currentState;"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":"    public Map\u003cString, String\u003e statesCache;"},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":28}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/repository/SessionRepository.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.repository;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.models.Session;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import org.springframework.data.mongodb.repository.MongoRepository;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"public interface SessionRepository extends MongoRepository\u003cSession, Long\u003e {"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":8}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/services/ExpertsService.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"package edu.kmaooad.services;"},{"lineNumber":2,"author":{"gitId":"-"},"content":""},{"lineNumber":3,"author":{"gitId":"-"},"content":"import edu.kmaooad.models.Expert;"},{"lineNumber":4,"author":{"gitId":"-"},"content":""},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"public interface ExpertsService {"},{"lineNumber":6,"author":{"gitId":"-"},"content":""},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"    Expert createExpert(Expert expert);"},{"lineNumber":8,"author":{"gitId":"-"},"content":""},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"    void deleteExpert(Expert expert);"},{"lineNumber":10,"author":{"gitId":"-"},"content":"}"}],"authorContributionMap":{"-":7,"sun-ok":3}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/services/ExpertsServiceImpl.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.services;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.models.Expert;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.repository.ExpertsRepository;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import org.springframework.beans.factory.annotation.Autowired;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Service;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"@Service"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"public class ExpertsServiceImpl implements ExpertsService {"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"    private final ExpertsRepository expertsRepository;"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"    @Autowired"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"    public ExpertsServiceImpl(ExpertsRepository expertsRepository) {"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":"        this.expertsRepository \u003d expertsRepository;"},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":"    public Expert createExpert(Expert expert){"},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"        return expertsRepository.save(expert);"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"    public void deleteExpert(Expert expert){"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":"        expertsRepository.delete(expert);"},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":25}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/services/LocaleMessageService.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.services;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import org.springframework.beans.factory.annotation.Value;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import org.springframework.context.MessageSource;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Service;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"import java.util.Locale;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"@Service"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"public class LocaleMessageService {"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"    private final Locale locale;"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"    private final MessageSource messageSource;"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":"    public LocaleMessageService(@Value(\"${localeTag}\") String localeTag, MessageSource messageSource) {"},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"        this.messageSource \u003d messageSource;"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"        this.locale \u003d Locale.forLanguageTag(localeTag);"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"    public String getMessage(String message) {"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"        return messageSource.getMessage(message, null, locale);"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":"    public String getMessage(String message, Object... args) {"},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"        return messageSource.getMessage(message, args, locale);"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":28}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/services/SessionService.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.services;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.models.Session;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.State;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import java.util.Optional;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"public interface SessionService {"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"    Optional\u003cSession\u003e getSessionByUserId(Long userId);"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"    Session createSessionById(Long userId) throws Exception;"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":"    Session updateStateById(Long userId, State state) throws Exception;"},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"    Session updateCacheById(Long userId, State.Group group, String cache) throws Exception;"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"    String getCacheById(Long userId, State.Group group) throws Exception;"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":19}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/services/SessionServiceImpl.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.services;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.statemachine.State;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.models.Session;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.repository.SessionRepository;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Service;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"import java.util.Map;"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"import java.util.Optional;"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"@Service"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"public class SessionServiceImpl implements SessionService {"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"    private final SessionRepository sessionRepository;"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"    public SessionServiceImpl(SessionRepository sessionRepository) {"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"        this.sessionRepository \u003d sessionRepository;"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"    public Optional\u003cSession\u003e getSessionByUserId(Long userId) {"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":"        return sessionRepository.findById(userId);"},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"    public Session createSessionById(Long userId) throws Exception {"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"        Optional\u003cSession\u003e session \u003d sessionRepository.findById(userId);"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"        if (session.isPresent()) {"},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":"            throw new Exception();"},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":32,"author":{"gitId":"sun-ok"},"content":"        return sessionRepository.save(new Session(userId));"},{"lineNumber":33,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":34,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":35,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":36,"author":{"gitId":"sun-ok"},"content":"    public Session updateStateById(Long userId, State state) throws Exception {"},{"lineNumber":37,"author":{"gitId":"sun-ok"},"content":"        Optional\u003cSession\u003e session \u003d sessionRepository.findById(userId);"},{"lineNumber":38,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":39,"author":{"gitId":"sun-ok"},"content":"        if (session.isEmpty()) {"},{"lineNumber":40,"author":{"gitId":"sun-ok"},"content":"            session \u003d Optional.of(createSessionById(userId));"},{"lineNumber":41,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":42,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":43,"author":{"gitId":"sun-ok"},"content":"        session.get().currentState \u003d state.key();"},{"lineNumber":44,"author":{"gitId":"sun-ok"},"content":"        return sessionRepository.save(session.get());"},{"lineNumber":45,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":46,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":47,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":48,"author":{"gitId":"sun-ok"},"content":"    public Session updateCacheById(Long userId, State.Group group, String cache) throws Exception {"},{"lineNumber":49,"author":{"gitId":"sun-ok"},"content":"        Optional\u003cSession\u003e session \u003d sessionRepository.findById(userId);"},{"lineNumber":50,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":51,"author":{"gitId":"sun-ok"},"content":"        if (session.isEmpty()) {"},{"lineNumber":52,"author":{"gitId":"sun-ok"},"content":"            session \u003d Optional.of(createSessionById(userId));"},{"lineNumber":53,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":54,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":55,"author":{"gitId":"sun-ok"},"content":"        session.get().statesCache.put(group.group(), cache);"},{"lineNumber":56,"author":{"gitId":"sun-ok"},"content":"        return sessionRepository.save(session.get());"},{"lineNumber":57,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":58,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":59,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":60,"author":{"gitId":"sun-ok"},"content":"    public String getCacheById(Long userId, State.Group group) throws Exception {"},{"lineNumber":61,"author":{"gitId":"sun-ok"},"content":"        Optional\u003cSession\u003e session \u003d sessionRepository.findById(userId);"},{"lineNumber":62,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":63,"author":{"gitId":"sun-ok"},"content":"        if (session.isEmpty()) {"},{"lineNumber":64,"author":{"gitId":"sun-ok"},"content":"            throw new Exception();"},{"lineNumber":65,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":66,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":67,"author":{"gitId":"sun-ok"},"content":"        Map\u003cString, String\u003e cacheMap \u003d session.get().statesCache;"},{"lineNumber":68,"author":{"gitId":"sun-ok"},"content":"        return cacheMap.get(group.group());"},{"lineNumber":69,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":70,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":70}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/services/TelegramService.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.services;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.telegram.TelegramApi;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Service;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.methods.ParseMode;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.methods.send.SendMessage;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"@Service"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"public class TelegramService {"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"    private final TelegramApi telegramApi;"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"    private final LocaleMessageService localeMessageService;"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"    public TelegramService(TelegramApi telegramApi, LocaleMessageService localeMessageService) {"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":"        this.telegramApi \u003d telegramApi;"},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"        this.localeMessageService \u003d localeMessageService;"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"    public void sendMessage(Long chatId, String text) {"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"        SendMessage sendMessage \u003d SendMessage"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"                .builder()"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":"                .text(localeMessageService.getMessage(text))"},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"                .chatId(chatId.toString())"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":"                .parseMode(ParseMode.HTML)"},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"                .build();"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"        try {"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"            telegramApi.execute(sendMessage);"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":"        } catch (Exception ignored) {"},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":31}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/statemachine/State.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.statemachine;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"public interface State {"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"    default String key() {"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"        return getClass().getName();"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"    interface Group {"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"        default String group() {"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"            return getClass().getName();"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"    class Any implements State {}"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":16}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/statemachine/StateMachine.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.statemachine;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import java.util.Optional;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"public interface StateMachine {"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"    void updateStateCache(Long userId, State.Group group, Object obj) throws Exception;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"    \u003cCache\u003e Optional\u003cCache\u003e getStateCache(Long userId, State.Group group, Class\u003cCache\u003e cacheClass);"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"    void setState(Long userId, State state) throws Exception;"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":12}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/statemachine/StateMachineImpl.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.statemachine;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import com.fasterxml.jackson.databind.ObjectMapper;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.services.SessionService;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Component;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"import java.util.Optional;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"@Component"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"public class StateMachineImpl implements StateMachine {"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":"    private final SessionService sessionService;"},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"    public StateMachineImpl(SessionService sessionService) {"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":"        this.sessionService \u003d sessionService;"},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"    public void setState(Long userId, State state) throws Exception {"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"        sessionService.updateStateById(userId, state);"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":22,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":23,"author":{"gitId":"sun-ok"},"content":"    public void updateStateCache(Long userId, State.Group group, Object obj) throws Exception {"},{"lineNumber":24,"author":{"gitId":"sun-ok"},"content":"        String cachedString \u003d new ObjectMapper().writeValueAsString(obj);"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"        sessionService.updateCacheById(userId, group, cachedString);"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"    public \u003cCache\u003e Optional\u003cCache\u003e getStateCache(Long userId, State.Group group, Class\u003cCache\u003e cacheClass) {"},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":"        try {"},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":"            String cache \u003d sessionService.getCacheById(userId, group);"},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":"            ObjectMapper mapper \u003d new ObjectMapper();"},{"lineNumber":32,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":33,"author":{"gitId":"sun-ok"},"content":"            return Optional.of(mapper.readValue(cache, cacheClass));"},{"lineNumber":34,"author":{"gitId":"sun-ok"},"content":"        } catch (Exception exception) {"},{"lineNumber":35,"author":{"gitId":"sun-ok"},"content":"            return Optional.empty();"},{"lineNumber":36,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":37,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":38,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":38}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/telegram/TelegramApi.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"package edu.kmaooad.telegram;"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.config.TelegramConfig;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import org.springframework.stereotype.Component;"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.bots.DefaultAbsSender;"},{"lineNumber":6,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.bots.DefaultBotOptions;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"@Component"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"public class TelegramApi extends DefaultAbsSender {"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"    TelegramConfig telegramConfig;"},{"lineNumber":11,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"    protected TelegramApi(TelegramConfig telegramConfig) {"},{"lineNumber":13,"author":{"gitId":"sun-ok"},"content":"        super(new DefaultBotOptions());"},{"lineNumber":14,"author":{"gitId":"sun-ok"},"content":"        this.telegramConfig \u003d telegramConfig;"},{"lineNumber":15,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":16,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":"    @Override"},{"lineNumber":18,"author":{"gitId":"sun-ok"},"content":"    public String getBotToken() {"},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"        return telegramConfig.getBotToken();"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"    }"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":"}"}],"authorContributionMap":{"sun-ok":21}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/webhook/TelegramWebHook.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"package edu.kmaooad.webhook;"},{"lineNumber":2,"author":{"gitId":"-"},"content":""},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.Dispatcher;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import edu.kmaooad.handlers.Handler;"},{"lineNumber":5,"author":{"gitId":"-"},"content":"import org.springframework.stereotype.Component;"},{"lineNumber":6,"author":{"gitId":"-"},"content":"import org.telegram.telegrambots.meta.api.methods.BotApiMethod;"},{"lineNumber":7,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.methods.send.SendMessage;"},{"lineNumber":8,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.CallbackQuery;"},{"lineNumber":9,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.Message;"},{"lineNumber":10,"author":{"gitId":"-"},"content":"import org.telegram.telegrambots.meta.api.objects.Update;"},{"lineNumber":11,"author":{"gitId":"-"},"content":""},{"lineNumber":12,"author":{"gitId":"sun-ok"},"content":"import java.util.List;"},{"lineNumber":13,"author":{"gitId":"-"},"content":"import java.util.function.Function;"},{"lineNumber":14,"author":{"gitId":"-"},"content":""},{"lineNumber":15,"author":{"gitId":"-"},"content":"@Component"},{"lineNumber":16,"author":{"gitId":"-"},"content":"public class TelegramWebHook implements Function\u003cUpdate, BotApiMethod\u003c?\u003e\u003e {"},{"lineNumber":17,"author":{"gitId":"sun-ok"},"content":"    private final Dispatcher dispatcher;"},{"lineNumber":18,"author":{"gitId":"-"},"content":""},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"    public TelegramWebHook(Dispatcher dispatcher, List\u003cHandler\u003e handlers) {"},{"lineNumber":20,"author":{"gitId":"sun-ok"},"content":"        this.dispatcher \u003d dispatcher;"},{"lineNumber":21,"author":{"gitId":"sun-ok"},"content":"        handlers.forEach(dispatcher::registerHandler);"},{"lineNumber":22,"author":{"gitId":"-"},"content":"    }"},{"lineNumber":23,"author":{"gitId":"-"},"content":""},{"lineNumber":24,"author":{"gitId":"-"},"content":"    @Override"},{"lineNumber":25,"author":{"gitId":"sun-ok"},"content":"    public BotApiMethod\u003c?\u003e apply(Update update) {"},{"lineNumber":26,"author":{"gitId":"sun-ok"},"content":"        if (update \u003d\u003d null) {"},{"lineNumber":27,"author":{"gitId":"sun-ok"},"content":"            return new SendMessage(update.getMessage().getChatId().toString(), \"reply.error\");"},{"lineNumber":28,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":29,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":30,"author":{"gitId":"sun-ok"},"content":"        if (update.hasMessage()) {"},{"lineNumber":31,"author":{"gitId":"sun-ok"},"content":"            Message message \u003d update.getMessage();"},{"lineNumber":32,"author":{"gitId":"sun-ok"},"content":"            dispatcher.dispatch(message);"},{"lineNumber":33,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":34,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":35,"author":{"gitId":"sun-ok"},"content":"        if (update.hasCallbackQuery()) {"},{"lineNumber":36,"author":{"gitId":"sun-ok"},"content":"            CallbackQuery callbackQuery \u003d update.getCallbackQuery();"},{"lineNumber":37,"author":{"gitId":"sun-ok"},"content":"            dispatcher.dispatch(callbackQuery);"},{"lineNumber":38,"author":{"gitId":"sun-ok"},"content":"        }"},{"lineNumber":39,"author":{"gitId":"sun-ok"},"content":""},{"lineNumber":40,"author":{"gitId":"sun-ok"},"content":"        return new SendMessage(update.getMessage().getChatId().toString(), \"reply.error\");"},{"lineNumber":41,"author":{"gitId":"-"},"content":"    }"},{"lineNumber":42,"author":{"gitId":"-"},"content":"}"}],"authorContributionMap":{"-":16,"sun-ok":26}},{"path":"kmaooad-functions/src/main/java/edu/kmaooad/webhook/TelegramWebhookHandler.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"package edu.kmaooad.webhook;"},{"lineNumber":2,"author":{"gitId":"-"},"content":""},{"lineNumber":3,"author":{"gitId":"lizaboiarchuk"},"content":"import com.fasterxml.jackson.databind.ObjectMapper;"},{"lineNumber":4,"author":{"gitId":"-"},"content":"import com.microsoft.azure.functions.*;"},{"lineNumber":5,"author":{"gitId":"-"},"content":"import com.microsoft.azure.functions.annotation.AuthorizationLevel;"},{"lineNumber":6,"author":{"gitId":"-"},"content":"import com.microsoft.azure.functions.annotation.FunctionName;"},{"lineNumber":7,"author":{"gitId":"-"},"content":"import com.microsoft.azure.functions.annotation.HttpTrigger;"},{"lineNumber":8,"author":{"gitId":"-"},"content":"import org.springframework.cloud.function.adapter.azure.FunctionInvoker;"},{"lineNumber":9,"author":{"gitId":"-"},"content":"import org.telegram.telegrambots.meta.api.methods.BotApiMethod;"},{"lineNumber":10,"author":{"gitId":"-"},"content":"import org.telegram.telegrambots.meta.api.objects.Update;"},{"lineNumber":11,"author":{"gitId":"-"},"content":""},{"lineNumber":12,"author":{"gitId":"-"},"content":"import java.util.Optional;"},{"lineNumber":13,"author":{"gitId":"-"},"content":""},{"lineNumber":14,"author":{"gitId":"-"},"content":"/**"},{"lineNumber":15,"author":{"gitId":"-"},"content":" * Azure Functions with HTTP Trigger."},{"lineNumber":16,"author":{"gitId":"-"},"content":" */"},{"lineNumber":17,"author":{"gitId":"-"},"content":"public class TelegramWebhookHandler extends FunctionInvoker\u003cUpdate, BotApiMethod\u003c?\u003e\u003e {"},{"lineNumber":18,"author":{"gitId":"-"},"content":""},{"lineNumber":19,"author":{"gitId":"-"},"content":"    /**"},{"lineNumber":20,"author":{"gitId":"-"},"content":"     * This function listens at endpoint \"/api/TelegramWebhook\". To invoke it using \"curl\" command in bash:"},{"lineNumber":21,"author":{"gitId":"-"},"content":"     * curl -d \"HTTP Body\" http://localhost:8080/api/TelegramWebhook"},{"lineNumber":22,"author":{"gitId":"-"},"content":"     */"},{"lineNumber":23,"author":{"gitId":"-"},"content":""},{"lineNumber":24,"author":{"gitId":"-"},"content":"    @FunctionName(\"TelegramWebhook\")"},{"lineNumber":25,"author":{"gitId":"-"},"content":"    public HttpResponseMessage run("},{"lineNumber":26,"author":{"gitId":"-"},"content":"            @HttpTrigger("},{"lineNumber":27,"author":{"gitId":"-"},"content":"                    name \u003d \"req\","},{"lineNumber":28,"author":{"gitId":"-"},"content":"                    methods \u003d {HttpMethod.POST},"},{"lineNumber":29,"author":{"gitId":"-"},"content":"                    authLevel \u003d AuthorizationLevel.FUNCTION)"},{"lineNumber":30,"author":{"gitId":"-"},"content":"            HttpRequestMessage\u003cOptional\u003cString\u003e\u003e request,"},{"lineNumber":31,"author":{"gitId":"-"},"content":"            final ExecutionContext context) {"},{"lineNumber":32,"author":{"gitId":"lizaboiarchuk"},"content":"        Update update;"},{"lineNumber":33,"author":{"gitId":"lizaboiarchuk"},"content":"        try {"},{"lineNumber":34,"author":{"gitId":"lizaboiarchuk"},"content":"            final String body \u003d request.getBody().get();"},{"lineNumber":35,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":36,"author":{"gitId":"lizaboiarchuk"},"content":"            final ObjectMapper mapper \u003d new ObjectMapper();"},{"lineNumber":37,"author":{"gitId":"lizaboiarchuk"},"content":"            update \u003d mapper.readValue(body, Update.class);"},{"lineNumber":38,"author":{"gitId":"lizaboiarchuk"},"content":"            handleRequest(update, context);"},{"lineNumber":39,"author":{"gitId":"lizaboiarchuk"},"content":"        } catch (Exception exception) {"},{"lineNumber":40,"author":{"gitId":"lizaboiarchuk"},"content":"            System.err.println(exception.getMessage());"},{"lineNumber":41,"author":{"gitId":"lizaboiarchuk"},"content":"        }"},{"lineNumber":42,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":43,"author":{"gitId":"lizaboiarchuk"},"content":"        return request"},{"lineNumber":44,"author":{"gitId":"lizaboiarchuk"},"content":"                .createResponseBuilder(HttpStatus.OK)"},{"lineNumber":45,"author":{"gitId":"lizaboiarchuk"},"content":"                .build();"},{"lineNumber":46,"author":{"gitId":"-"},"content":"    }"},{"lineNumber":47,"author":{"gitId":"-"},"content":"}"}],"authorContributionMap":{"lizaboiarchuk":15,"-":32}},{"path":"kmaooad-functions/src/main/resources/application.properties","fileType":"properties","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"#MongoDB server settings"},{"lineNumber":2,"author":{"gitId":"-"},"content":"spring.data.mongodb.uri\u003dmongodb+srv://admin:admin@cluster0.tn0cl.mongodb.net/?retryWrites\u003dtrue\u0026w\u003dmajority"},{"lineNumber":3,"author":{"gitId":"-"},"content":"spring.data.mongodb.database\u003dcaja22-bots"},{"lineNumber":4,"author":{"gitId":"-"},"content":""},{"lineNumber":5,"author":{"gitId":"-"},"content":"#Bot settings"},{"lineNumber":6,"author":{"gitId":"-"},"content":"api-url\u003d \"https://api.telegram.org/\""},{"lineNumber":7,"author":{"gitId":"-"},"content":"webhook-path\u003d \"https://localhost:8080/api/TelegramWebhook\""},{"lineNumber":8,"author":{"gitId":"-"},"content":"bot-name\u003d kmaooad-bots"},{"lineNumber":9,"author":{"gitId":"-"},"content":"bot-token\u003d 5769072800:AAFnJGcVW2BBIwq7x96SUYV-KFaOa11l-CQ"},{"lineNumber":10,"author":{"gitId":"sun-ok"},"content":"localeTag\u003den-En"}],"authorContributionMap":{"-":9,"sun-ok":1}},{"path":"kmaooad-functions/src/main/resources/messages_en_EN.properties","fileType":"properties","lines":[{"lineNumber":1,"author":{"gitId":"sun-ok"},"content":"reply.error \u003d Unexpected exception, try again"},{"lineNumber":2,"author":{"gitId":"sun-ok"},"content":"reply.getEmail \u003d Enter expert`s email"},{"lineNumber":3,"author":{"gitId":"sun-ok"},"content":"reply.getName \u003d Enter expert`s name"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"reply.getType \u003d Enter expert`s type"},{"lineNumber":5,"author":{"gitId":"sun-ok"},"content":"reply.expertWasCreated \u003d Expert was created"}],"authorContributionMap":{"sun-ok":5}},{"path":"kmaooad-functions/src/test/java/edu/kmaooad/ExpertManagementTest.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"package edu.kmaooad;"},{"lineNumber":2,"author":{"gitId":"-"},"content":""},{"lineNumber":3,"author":{"gitId":"-"},"content":"import org.junit.jupiter.api.Test;"},{"lineNumber":4,"author":{"gitId":"sun-ok"},"content":"import org.telegram.telegrambots.meta.api.objects.Update;"},{"lineNumber":5,"author":{"gitId":"-"},"content":""},{"lineNumber":6,"author":{"gitId":"-"},"content":""},{"lineNumber":7,"author":{"gitId":"-"},"content":"public class ExpertManagementTest {"},{"lineNumber":8,"author":{"gitId":"-"},"content":""},{"lineNumber":9,"author":{"gitId":"-"},"content":"    final static String botUpdateQuery \u003d \"{\\\"update_id\\\":983721550,\\n\" +"},{"lineNumber":10,"author":{"gitId":"-"},"content":"            \"\\\"message\\\":{\\\"message_id\\\":6,\\\"from\\\":{\\\"id\\\":421325006,\\\"is_bot\\\":false,\\\"\" +"},{"lineNumber":11,"author":{"gitId":"-"},"content":"            \"first_name\\\":\\\"John\\\",\\\"last_name\\\":\\\"Smith\\\",\\\"username\\\":\\\"Sun_0k\" +"},{"lineNumber":12,"author":{"gitId":"-"},"content":"            \"\\\",\\\"language_code\\\":\\\"ru\\\"},\\\"chat\\\":{\\\"id\\\":421325006,\\\"first_name\\\":\\\"John\\\",\\\"l\" +"},{"lineNumber":13,"author":{"gitId":"-"},"content":"            \"ast_name\\\":\\\"Smith\\\",\\\"username\\\":\\\"Sun_0k\\\",\\\"type\\\":\\\"private\\\"},\\\"date\\\":1664723185,\\\"\" +"},{"lineNumber":14,"author":{"gitId":"-"},"content":"            \"text\\\":\\\"addExpert\\\"}}\";"},{"lineNumber":15,"author":{"gitId":"-"},"content":""},{"lineNumber":16,"author":{"gitId":"-"},"content":"    @Test"},{"lineNumber":17,"author":{"gitId":"-"},"content":"    public void createBotUpdate(){"},{"lineNumber":18,"author":{"gitId":"-"},"content":""},{"lineNumber":19,"author":{"gitId":"sun-ok"},"content":"        Update update \u003d new Update();"},{"lineNumber":20,"author":{"gitId":"-"},"content":"    }"},{"lineNumber":21,"author":{"gitId":"-"},"content":""},{"lineNumber":22,"author":{"gitId":"-"},"content":"}"}],"authorContributionMap":{"-":20,"sun-ok":2}},{"path":"kmaooad-functions/src/test/java/edu/kmaooad/services/ExpertServiceTest.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"lizaboiarchuk"},"content":"package edu.kmaooad.services;"},{"lineNumber":2,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":3,"author":{"gitId":"lizaboiarchuk"},"content":"import edu.kmaooad.models.Expert;"},{"lineNumber":4,"author":{"gitId":"lizaboiarchuk"},"content":"import edu.kmaooad.repository.ExpertsRepository;"},{"lineNumber":5,"author":{"gitId":"lizaboiarchuk"},"content":"import org.junit.Test;"},{"lineNumber":6,"author":{"gitId":"lizaboiarchuk"},"content":"import static org.junit.Assert.assertEquals;"},{"lineNumber":7,"author":{"gitId":"lizaboiarchuk"},"content":"import static org.mockito.ArgumentMatchers.any;"},{"lineNumber":8,"author":{"gitId":"lizaboiarchuk"},"content":"import static org.mockito.Mockito.*;"},{"lineNumber":9,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":10,"author":{"gitId":"lizaboiarchuk"},"content":"public class ExpertServiceTest {"},{"lineNumber":11,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":12,"author":{"gitId":"lizaboiarchuk"},"content":"    private final ExpertsRepository expertsRepository \u003d mock(ExpertsRepository.class);"},{"lineNumber":13,"author":{"gitId":"lizaboiarchuk"},"content":"    private final ExpertsService expertsService \u003d new ExpertsServiceImpl(expertsRepository);"},{"lineNumber":14,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":15,"author":{"gitId":"lizaboiarchuk"},"content":"    @Test"},{"lineNumber":16,"author":{"gitId":"lizaboiarchuk"},"content":"    public void shouldCreateExpert() {"},{"lineNumber":17,"author":{"gitId":"lizaboiarchuk"},"content":"        when(expertsRepository.save(any()))"},{"lineNumber":18,"author":{"gitId":"lizaboiarchuk"},"content":"                .then(invocationOnMock -\u003e invocationOnMock.getArgument(0));"},{"lineNumber":19,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":20,"author":{"gitId":"lizaboiarchuk"},"content":"        Expert expert \u003d new Expert(\"email\", \"type\", \"name\");"},{"lineNumber":21,"author":{"gitId":"lizaboiarchuk"},"content":"        Expert result \u003d expertsService.createExpert(expert);"},{"lineNumber":22,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":23,"author":{"gitId":"lizaboiarchuk"},"content":"        assertEquals(expert, result);"},{"lineNumber":24,"author":{"gitId":"lizaboiarchuk"},"content":"        verify(expertsRepository, times(1))"},{"lineNumber":25,"author":{"gitId":"lizaboiarchuk"},"content":"                .save(expert);"},{"lineNumber":26,"author":{"gitId":"lizaboiarchuk"},"content":"    }"},{"lineNumber":27,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":28,"author":{"gitId":"lizaboiarchuk"},"content":"    @Test"},{"lineNumber":29,"author":{"gitId":"lizaboiarchuk"},"content":"    public void shouldDeleteExpert() {"},{"lineNumber":30,"author":{"gitId":"lizaboiarchuk"},"content":"        expertsService.deleteExpert(any());"},{"lineNumber":31,"author":{"gitId":"lizaboiarchuk"},"content":"        verify(expertsRepository, times(1))"},{"lineNumber":32,"author":{"gitId":"lizaboiarchuk"},"content":"                .delete(any());"},{"lineNumber":33,"author":{"gitId":"lizaboiarchuk"},"content":"    }"},{"lineNumber":34,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":35,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":36,"author":{"gitId":"lizaboiarchuk"},"content":"}"}],"authorContributionMap":{"lizaboiarchuk":36}},{"path":"kmaooad-functions/src/test/java/edu/kmaooad/services/LocaleMessageServiceTest.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"lizaboiarchuk"},"content":"package edu.kmaooad.services;"},{"lineNumber":2,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":3,"author":{"gitId":"lizaboiarchuk"},"content":"import org.junit.Test;"},{"lineNumber":4,"author":{"gitId":"lizaboiarchuk"},"content":"import org.springframework.context.MessageSource;"},{"lineNumber":5,"author":{"gitId":"lizaboiarchuk"},"content":"import static org.mockito.ArgumentMatchers.any;"},{"lineNumber":6,"author":{"gitId":"lizaboiarchuk"},"content":"import static org.mockito.Mockito.*;"},{"lineNumber":7,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":8,"author":{"gitId":"lizaboiarchuk"},"content":"public class LocaleMessageServiceTest {"},{"lineNumber":9,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":10,"author":{"gitId":"lizaboiarchuk"},"content":"    private final MessageSource messageSource \u003d mock(MessageSource.class);"},{"lineNumber":11,"author":{"gitId":"lizaboiarchuk"},"content":"    private final LocaleMessageService localeMessageService \u003d new LocaleMessageService(\"${localeTag}\", messageSource);"},{"lineNumber":12,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":13,"author":{"gitId":"lizaboiarchuk"},"content":"    @Test"},{"lineNumber":14,"author":{"gitId":"lizaboiarchuk"},"content":"    public void shouldGetMessage() {"},{"lineNumber":15,"author":{"gitId":"lizaboiarchuk"},"content":"        when(messageSource.getMessage(any(), any(), any()))"},{"lineNumber":16,"author":{"gitId":"lizaboiarchuk"},"content":"                .then(invocationOnMock -\u003e invocationOnMock.getArgument(0));"},{"lineNumber":17,"author":{"gitId":"lizaboiarchuk"},"content":"        String message \u003d \"mess\";"},{"lineNumber":18,"author":{"gitId":"lizaboiarchuk"},"content":"        String result \u003d localeMessageService.getMessage(message);"},{"lineNumber":19,"author":{"gitId":"lizaboiarchuk"},"content":"        verify(messageSource, times(1))"},{"lineNumber":20,"author":{"gitId":"lizaboiarchuk"},"content":"                .getMessage(any(), any(), any());"},{"lineNumber":21,"author":{"gitId":"lizaboiarchuk"},"content":"    }"},{"lineNumber":22,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":23,"author":{"gitId":"lizaboiarchuk"},"content":"}"}],"authorContributionMap":{"lizaboiarchuk":23}},{"path":"kmaooad-functions/src/test/java/edu/kmaooad/services/SessionServiceTest.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"lizaboiarchuk"},"content":"package edu.kmaooad.services;"},{"lineNumber":2,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":3,"author":{"gitId":"lizaboiarchuk"},"content":"import edu.kmaooad.models.Session;"},{"lineNumber":4,"author":{"gitId":"lizaboiarchuk"},"content":"import edu.kmaooad.repository.SessionRepository;"},{"lineNumber":5,"author":{"gitId":"lizaboiarchuk"},"content":"import org.junit.Test;"},{"lineNumber":6,"author":{"gitId":"lizaboiarchuk"},"content":"import java.util.Optional;"},{"lineNumber":7,"author":{"gitId":"lizaboiarchuk"},"content":"import static org.mockito.ArgumentMatchers.any;"},{"lineNumber":8,"author":{"gitId":"lizaboiarchuk"},"content":"import static org.mockito.Mockito.*;"},{"lineNumber":9,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":10,"author":{"gitId":"lizaboiarchuk"},"content":"public class SessionServiceTest {"},{"lineNumber":11,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":12,"author":{"gitId":"lizaboiarchuk"},"content":"    private final SessionRepository sessionRepository \u003d mock(SessionRepository.class);"},{"lineNumber":13,"author":{"gitId":"lizaboiarchuk"},"content":"    private final SessionService sessionService \u003d new SessionServiceImpl(sessionRepository);"},{"lineNumber":14,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":15,"author":{"gitId":"lizaboiarchuk"},"content":"    @Test"},{"lineNumber":16,"author":{"gitId":"lizaboiarchuk"},"content":"    public void shouldReturnUser() {"},{"lineNumber":17,"author":{"gitId":"lizaboiarchuk"},"content":"        when(sessionRepository.findById(any()))"},{"lineNumber":18,"author":{"gitId":"lizaboiarchuk"},"content":"                .then(invocationOnMock -\u003e invocationOnMock.getArgument(0));"},{"lineNumber":19,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":20,"author":{"gitId":"lizaboiarchuk"},"content":"        Optional\u003cSession\u003e session \u003d sessionService.getSessionByUserId(any());"},{"lineNumber":21,"author":{"gitId":"lizaboiarchuk"},"content":"        verify(sessionRepository, times(1))"},{"lineNumber":22,"author":{"gitId":"lizaboiarchuk"},"content":"                .findById(any());"},{"lineNumber":23,"author":{"gitId":"lizaboiarchuk"},"content":"    }"},{"lineNumber":24,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":25,"author":{"gitId":"lizaboiarchuk"},"content":"    @Test"},{"lineNumber":26,"author":{"gitId":"lizaboiarchuk"},"content":"    public void shouldCreateSession() throws Exception {"},{"lineNumber":27,"author":{"gitId":"lizaboiarchuk"},"content":"        when(sessionRepository.save(any()))"},{"lineNumber":28,"author":{"gitId":"lizaboiarchuk"},"content":"                .then(invocationOnMock -\u003e invocationOnMock.getArgument(0));"},{"lineNumber":29,"author":{"gitId":"lizaboiarchuk"},"content":"        Session session \u003d sessionService.createSessionById(any());"},{"lineNumber":30,"author":{"gitId":"lizaboiarchuk"},"content":"        verify(sessionRepository, times(1))"},{"lineNumber":31,"author":{"gitId":"lizaboiarchuk"},"content":"                .save(any());"},{"lineNumber":32,"author":{"gitId":"lizaboiarchuk"},"content":"    }"},{"lineNumber":33,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":34,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":35,"author":{"gitId":"lizaboiarchuk"},"content":"}"}],"authorContributionMap":{"lizaboiarchuk":35}},{"path":"kmaooad-functions/src/test/java/edu/kmaooad/services/TelegramServiceTest.java","fileType":"java","lines":[{"lineNumber":1,"author":{"gitId":"lizaboiarchuk"},"content":"package edu.kmaooad.services;"},{"lineNumber":2,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":3,"author":{"gitId":"lizaboiarchuk"},"content":"import org.junit.Test;"},{"lineNumber":4,"author":{"gitId":"lizaboiarchuk"},"content":"import static org.mockito.ArgumentMatchers.any;"},{"lineNumber":5,"author":{"gitId":"lizaboiarchuk"},"content":"import edu.kmaooad.telegram.TelegramApi;"},{"lineNumber":6,"author":{"gitId":"lizaboiarchuk"},"content":"import org.telegram.telegrambots.meta.api.methods.send.SendMessage;"},{"lineNumber":7,"author":{"gitId":"lizaboiarchuk"},"content":"import org.telegram.telegrambots.meta.exceptions.TelegramApiException;"},{"lineNumber":8,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":9,"author":{"gitId":"lizaboiarchuk"},"content":"import static org.mockito.Mockito.*;"},{"lineNumber":10,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":11,"author":{"gitId":"lizaboiarchuk"},"content":"public class TelegramServiceTest {"},{"lineNumber":12,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":13,"author":{"gitId":"lizaboiarchuk"},"content":"    private final TelegramApi telegramApi \u003d mock(TelegramApi.class);"},{"lineNumber":14,"author":{"gitId":"lizaboiarchuk"},"content":"    private final LocaleMessageService localeMessageService \u003d mock(LocaleMessageService.class);"},{"lineNumber":15,"author":{"gitId":"lizaboiarchuk"},"content":"    private final TelegramService telegramService \u003d new TelegramService(telegramApi, localeMessageService);"},{"lineNumber":16,"author":{"gitId":"lizaboiarchuk"},"content":""},{"lineNumber":17,"author":{"gitId":"lizaboiarchuk"},"content":"    @Test"},{"lineNumber":18,"author":{"gitId":"lizaboiarchuk"},"content":"    public void shouldSendMessage() throws TelegramApiException {"},{"lineNumber":19,"author":{"gitId":"lizaboiarchuk"},"content":"        telegramService.sendMessage(0L, \"hi there\");"},{"lineNumber":20,"author":{"gitId":"lizaboiarchuk"},"content":"        verify(telegramApi, times(1))"},{"lineNumber":21,"author":{"gitId":"lizaboiarchuk"},"content":"                .execute(any(SendMessage.class));"},{"lineNumber":22,"author":{"gitId":"lizaboiarchuk"},"content":"    }"},{"lineNumber":23,"author":{"gitId":"lizaboiarchuk"},"content":"}"}],"authorContributionMap":{"lizaboiarchuk":23}}]
